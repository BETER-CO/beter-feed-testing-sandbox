version: '3.7'

name: "bfts"

services:
  kafka:
    extends:
      file: docker-compose.yml
      service: kafka
    ports:
      - "${BFTS_KAFKA_PORT:-9092}:9092"
    environment:
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: "INTERNAL_DOCKER_HOST:PLAINTEXT,INTERNAL_DOCKER_CONTROLLER_HOST:PLAINTEXT,EXTERNAL_HOST:PLAINTEXT"
      KAFKA_ADVERTISED_LISTENERS: "INTERNAL_DOCKER_HOST://kafka:29092,EXTERNAL_HOST://localhost:${BFTS_KAFKA_PORT:-9092}"
      KAFKA_LISTENERS: "INTERNAL_DOCKER_HOST://0.0.0.0:29092,INTERNAL_DOCKER_CONTROLLER_HOST://kafka:29093,EXTERNAL_HOST://0.0.0.0:9092"

  init-kafka:
    extends:
      file: docker-compose.yml
      service: init-kafka
    depends_on:
      kafka:
        condition: service_healthy

  kafka-ui:
    extends:
      file: docker-compose.yml
      service: kafka-ui
    depends_on:
      kafka:
        condition: service_healthy

networks:
  feed-testing-sandbox:
    driver: bridge

volumes:
  kafka-broker-data:
